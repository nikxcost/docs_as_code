async function createFeature(tp) {
    // Запрашиваем название feature
    const featureName = await tp.system.prompt("Название новой Feature:");
    if (!featureName) return "Отменено";

    // Получаем текущую папку
    const currentFolder = tp.file.folder(true);

    // Проверяем что мы в папке features
    if (!currentFolder.includes("features")) {
        return "Ошибка: выполните команду из папки features";
    }

    // Создаём путь к новой папке
    const featureFolder = `${currentFolder}/${featureName}`;

    // Создаём папку
    await app.vault.createFolder(featureFolder);

    // Содержимое index.md
    const indexContent = `# ${featureName}

## Зачем это нужно

Краткое описание бизнес-проблемы, которую решает данная функция.

## Бизнес-эффект

Ожидаемый эффект для бизнеса:

- Метрика 1: ожидаемое изменение
- Метрика 2: ожидаемое изменение

## Пользователи и сценарии

**Основные пользователи:**

- Тип пользователя 1
- Тип пользователя 2

**Ключевые сценарии:**

1. Сценарий 1: описание
2. Сценарий 2: описание

## Функциональные требования

| ID | Описание | Приоритет |
|----|----------|-----------|
| FR-001 | Требование 1 | Must |
| FR-002 | Требование 2 | Should |
| FR-003 | Требование 3 | Could |

## Нефункциональные требования

| Категория | Требование |
|-----------|------------|
| Производительность | Время отклика < X мс |
| Доступность | SLA 99.9% |
| Безопасность | Требование безопасности |

## Ограничения и допущения

**Ограничения:**

- Техническое ограничение 1
- Бизнес-ограничение 1

**Допущения:**

- Допущение 1
- Допущение 2

## Связанные сервисы

- \`service-name-1\` — описание взаимодействия
- \`service-name-2\` — описание взаимодействия
`;

    // Содержимое requirements.md
    const requirementsContent = `# Требования: ${featureName}

## Функциональные требования

| ID | Описание | Приоритет | Статус |
|----|----------|-----------|--------|
| FR-001 | Требование 1 | Must | Planned |
| FR-002 | Требование 2 | Should | Planned |
| FR-003 | Требование 3 | Could | Planned |

## Нефункциональные требования

| Категория | ID | Требование |
|-----------|-----|------------|
| Производительность | NFR-001 | Операция должна выполняться < X секунд |
| Доступность | NFR-002 | Функция доступна 99.9% времени |
| Безопасность | NFR-003 | Требование безопасности |
| Аудит | NFR-004 | Все операции логируются |

## Бизнес-правила

| ID | Правило |
|----|---------|
| BR-001 | Бизнес-правило 1 |
| BR-002 | Бизнес-правило 2 |
| BR-003 | Бизнес-правило 3 |

## Acceptance Criteria

### AC-001: Название сценария

**Given:** Предусловие (начальное состояние системы)
**When:** Действие пользователя
**Then:**

- Ожидаемый результат 1
- Ожидаемый результат 2
`;

    // Содержимое process.md
    const processContent = `# Процесс: ${featureName}

## Диаграмма процесса

\`\`\`mermaid
flowchart TD
    A[Начало] --> B{Условие?}
    B -->|Да| C[Действие 1]
    B -->|Нет| D[Действие 2]
    C --> E[Конец]
    D --> E
\`\`\`

## Шаги процесса

1. **Шаг 1** — описание
2. **Шаг 2** — описание
3. **Шаг 3** — описание

## Участники

| Роль | Ответственность |
|------|-----------------|
| Пользователь | Инициирует процесс |
| Система | Обрабатывает запрос |

## Исключения

| Ситуация | Действие |
|----------|----------|
| Ошибка валидации | Показать сообщение об ошибке |
| Таймаут | Повторить запрос |
`;

    // Создаём файлы
    await app.vault.create(`${featureFolder}/index.md`, indexContent);
    await app.vault.create(`${featureFolder}/requirements.md`, requirementsContent);
    await app.vault.create(`${featureFolder}/process.md`, processContent);

    // Открываем index.md
    const file = app.vault.getAbstractFileByPath(`${featureFolder}/index.md`);
    await app.workspace.getLeaf().openFile(file);

    return `Feature "${featureName}" создана!`;
}

module.exports = createFeature;
