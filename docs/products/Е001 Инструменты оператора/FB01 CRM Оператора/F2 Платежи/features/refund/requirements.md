# Требования: Refund (Возврат средств)

## Функциональные требования

| ID | Описание | Приоритет | Статус |
|----|----------|-----------|--------|
| FR-REF-001 | Система должна позволять клиенту инициировать возврат через личный кабинет | Must | Done |
| FR-REF-002 | Система должна автоматически проверять возможность возврата (срок, тип товара) | Must | Done |
| FR-REF-003 | Система должна поддерживать полный возврат всего заказа | Must | Done |
| FR-REF-004 | Система должна поддерживать частичный возврат отдельных позиций | Should | In Progress |
| FR-REF-005 | Оператор поддержки должен иметь возможность оформить возврат вручную | Must | Done |
| FR-REF-006 | Система должна отправлять уведомление клиенту о статусе возврата | Should | Done |
| FR-REF-007 | Система должна формировать чек возврата | Must | Planned |
| FR-REF-008 | Финансовый менеджер должен видеть отчет по возвратам | Could | Planned |

## Нефункциональные требования

| Категория | ID | Требование |
|-----------|-----|------------|
| Производительность | NFR-REF-001 | Операция возврата должна выполняться < 5 секунд |
| Доступность | NFR-REF-002 | Функция возврата доступна 99.9% времени |
| Безопасность | NFR-REF-003 | Возврат требует подтверждения через 2FA для сумм > 10 000 руб |
| Аудит | NFR-REF-004 | Все операции возврата логируются с сохранением истории изменений |

## Бизнес-правила

| ID | Правило |
|----|---------|
| BR-REF-001 | Возврат возможен в течение 14 календарных дней с момента покупки |
| BR-REF-002 | Возврат цифровых товаров невозможен после активации |
| BR-REF-003 | Возврат выполняется на исходный способ оплаты |
| BR-REF-004 | При частичном возврате пересчитываются скидки |
| BR-REF-005 | Возврат товара по акции возвращает фактически уплаченную сумму |

## Acceptance Criteria

### AC-001: Успешный полный возврат

**Given:** Клиент оплатил заказ картой 3 дня назад
**When:** Клиент запрашивает полный возврат через ЛК
**Then:**
- Статус заказа меняется на "Возврат"
- Средства возвращаются на карту в течение 5 рабочих дней
- Клиент получает email-уведомление
- В истории заказа отображается операция возврата

### AC-002: Отказ в возврате по сроку

**Given:** Клиент оплатил заказ 20 дней назад
**When:** Клиент запрашивает возврат через ЛК
**Then:**
- Система показывает сообщение о невозможности возврата
- Предлагается связаться с поддержкой

### AC-003: Частичный возврат

**Given:** Заказ содержит 3 позиции на сумму 3000 руб
**When:** Клиент запрашивает возврат 1 позиции стоимостью 1000 руб
**Then:**
- Возвращается 1000 руб на карту
- Заказ остается в статусе "Выполнен" с пометкой о частичном возврате
- История заказа содержит детали частичного возврата
